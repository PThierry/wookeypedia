\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage{tikz}
\usetikzlibrary{fit,calc,positioning,decorations.pathreplacing,patterns,matrix}
\usepackage{verbatim}
\usepackage{color}
\usepackage[active,tightpage]{preview}
\PreviewEnvironment{tikzpicture}

\begin{document}

\begin{tikzpicture}
    %%% ISR Queue
    % title
    \draw (1,4.5) node {\small{ISR}};
    \draw (1,4.2) node {\small{Queue}};

    \draw (2,5) -- (2,4) -- (2.5,4) -- (2.5,5);
    %
    % queue push
    \draw (3,5) -- (3,4) -- (3.5,4) -- (3.5,5);
    \draw [pattern color=blue, pattern=north west lines](3.1,4.4) rectangle (3.4,4.1);
    % queue pop
    \draw (3.6,5) -- (3.6,4) -- (4.1,4) -- (4.1,5);
    \draw[->,>=latex] (3.85,4) -- (3.85,3.7);

    % queue push
    \draw (6,5) -- (6,4) -- (6.5,4) -- (6.5,5);
    \draw [pattern color=olive, pattern=north east lines](6.1,4.4) rectangle (6.4,4.1);

    % queue pop
    \draw (6.6,5) -- (6.6,4) -- (7.1,4) -- (7.1,5);
    \draw[->,>=latex] (6.85,4) -- (6.85,3.7);

    % queue push
    \draw (7.5,5) -- (7.5,4) -- (8,4) -- (8,5);
    \draw [pattern color=violet, pattern=dots](7.6,4.4) rectangle (7.9,4.1);

    % queue push
    \draw (9,5) -- (9,4) -- (9.5,4) -- (9.5,5);
    \draw [pattern color=violet, pattern=dots](9.1,4.4) rectangle (9.4,4.1);
    \draw [pattern color=teal, pattern=crosshatch](9.1,4.8) rectangle (9.4,4.5);

    % queue pop
    \draw (10,5) -- (10,4) -- (10.5,4) -- (10.5,5);
    \draw [pattern color=teal, pattern=crosshatch](10.1,4.1) rectangle (10.4,4.4);
    \draw[->,>=latex] (10.25,4) -- (10.25,3.7);

    % queue pop
    \draw (11,5) -- (11,4) -- (11.5,4) -- (11.5,5);
    \draw[->,>=latex] (11.25,4) -- (11 .25,3.7);

    %%%%%%%%%%%%%% IRQ
    \draw (1,6.5) node {\small{IRQ}};
    %
    \draw[color=blue,->,>=latex] (3.2,7) -- (3,6.75) -- (3.2,6.75) -- (3,6.5);

    \draw[color=olive,->,>=latex] (6.2,7) -- (6,6.75) -- (6.2,6.75) -- (6,6.5);

    \draw[color=violet,->,>=latex] (7.7,7) -- (7.5,6.75) -- (7.7,6.75) -- (7.5,6.5);

    \draw[color=teal,->,>=latex] (9.2,7) -- (9,6.75) -- (9.2,6.75) -- (9,6.5);

    %%%%%%%%%%%%%% kernel handler line
    \draw[dashed,->,>=latex] (2,5.5) -- (13.5,5.5);
    \draw (1,5.5) node {\small{EwoK kernel}};

    \draw[fill=red!20] (3,5.5) rectangle (3.5,6);
    \draw[->,>=latex] (3.25,5.5) -- (3.25,5.25);

    \draw[fill=red!20] (6,5.5) rectangle (6.5,6);
    \draw[->,>=latex] (6.25,5.5) -- (6.25,5.25);

    \draw[fill=red!20] (7.5,5.5) rectangle (8,6);
    \draw[->,>=latex] (7.75,5.5) -- (7.75,5.25);

    \draw[fill=red!20] (9,5.5) rectangle (9.5,6);
    \draw[->,>=latex] (9.25,5.5) -- (9.25,5.25);

    %%%%%%%%%%%%%%% T0 matrix
    % line title
    \draw[align=left] (1,3) node (t0_isr_title) {ISR};
    \draw[align=left] (1,2) node (t0_mt_title) {MT};
    %lines
    \draw [dashed,->,>=latex] (2,3) -- (13.5,3);
    \draw [->,>=latex] (2,2) -- (13.5,2);

    % MT execution
    \draw[fill=gray!30] (2,2) rectangle (3,2.5);
    \draw[fill=gray!30] (4.5,2) rectangle (5,2.5);

    % ISR execution
    \draw[pattern color=blue, pattern=north west lines] (3.5,3) rectangle (4.5,3.5);

    \draw[pattern color=violet, pattern=dots] (10,3) rectangle (11,3.5);
    \draw[pattern color=teal, pattern=crosshatch] (11,3) rectangle (12,3.5);

    % t0 brace
    \draw[decorate,line width=1.5pt,decoration={brace,amplitude=3pt,mirror}]
    (t0_isr_title.north west) -- (t0_mt_title.south west) node [midway,xshift=-0.2cm,left] {$T_0$};

    %%%%%%%%%%%%%%% T1 Matrix
    % line title
    \draw[align=left] (1,1) node (t1_isr_title) {ISR};
    \draw[align=left] (1,0) node (t1_mt_title) {MT};
    % lines
    \draw [dashed,->,>=latex] (2,1) -- (13.5,1);
    \draw [->,>=latex] (2,0) -- (13.5,0);

    % MT execution
    \draw[fill=gray!10] (5,0) rectangle (6,0.5);
    \draw[fill=gray!10] (12,0) rectangle (13,0.5);

    % ISR execution
    \draw[pattern color=olive, pattern=north east lines] (6.5,1) rectangle (7.5,1.5);
    \draw[pattern color=olive, pattern=north east lines] (8,1) rectangle (9,1.5);
    \draw[pattern color=olive, pattern=north east lines] (9.5,1) rectangle (10,1.5);

    % t1 brace
    \draw[decorate,line width=1.5pt,decoration={brace,amplitude=3pt,mirror}]
    (t1_isr_title.north west) -- (t1_mt_title.south west) node [midway,xshift=-0.2cm,left] {$T_1$};

    % Legend
    \node[yshift=-1cm, xshift=2cm] (mtlegend) at (t1_mt_title.south) {MT: Main Thread};
    \node[yshift=-.3cm, xshift=.85cm, anchor=north] (isrlegend) at (mtlegend.south) {ISR: Iterrupt Service Routine};
    \node[yshift=.5cm, xshift=5cm, anchor=east] (tasklegend) at (isrlegend.east) {$T_0$: task 0, $T_1$: task 1};
\end{tikzpicture}

\end{document}
